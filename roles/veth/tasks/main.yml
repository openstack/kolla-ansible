---
- name: Create veth pair
  become: true
  ansible.builtin.command:
    cmd: ip link add {{ veth_pair.0 }} type veth peer name {{ veth_pair.1 }}
  changed_when: true

- name: Bring veth pair up
  become: true
  ansible.builtin.shell:
    cmd: ip link set {{ veth_pair.0 }} up && ip link set {{ veth_pair.1 }} up
  changed_when: true

- name: Add first veth pair port to bridge
  become: true
  ansible.builtin.command:
    cmd: ip link set {{ veth_pair.0 }} master {{ bridge_name }}
  changed_when: true
