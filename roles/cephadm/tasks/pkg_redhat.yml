---
- name: Ensure yum repos directory exists
  become: true
  file:
    path: /etc/yum.repos.d/
    state: directory
    recurse: true

- name: Install centos-release-ceph
  become: true
  dnf:
    name: "centos-release-ceph-{{ cephadm_ceph_release }}"
  when: cephadm_use_package_from_distribution

- name: Enable Ceph base yum repository
  become: true
  yum_repository:
    name: "{{ item.shortname }}"
    description: "{{ item.name }}"
    baseurl: "{{ item.url }}"
    gpgkey: "{{ cephadm_ceph_rpm_gpg_key }}"
  loop: "{{ cephadm_ceph_rpm_repos }}"
  when: not cephadm_use_package_from_distribution

# NOTE(mnasiadka): cephadm bootstrap failing on jinja2 missing
- name: Install cephadm and jinja2
  become: true
  dnf:
    name:
      - cephadm
      - python3-jinja2
    install_weak_deps: false
