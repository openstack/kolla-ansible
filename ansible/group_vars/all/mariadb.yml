---
enable_mariadb: true
enable_mariabackup: false

#############################################
# MariaDB component-specific database details
#############################################
# Whether to configure haproxy to load balance
# the external MariaDB server(s)
enable_external_mariadb_load_balancer: false
# Whether to use pre-configured databases / users
use_preconfigured_databases: false
# whether to use a common, preconfigured user
# for all component databases
use_common_mariadb_user: false

mariadb_port: "{{ database_port }}"
mariadb_wsrep_port: "4567"
mariadb_ist_port: "4568"
mariadb_sst_port: "4444"
mariadb_enable_tls_backend: "{{ database_enable_tls_backend }}"

mariadb_monitor_user: "monitor"

mariadb_datadir_volume: "mariadb"

mariadb_default_database_shard_id: 0
#  NOTE(blanson) this little trick is made to work in ansible 2.19 and up
# in multiline scalar that need to return a non-string object
mariadb_default_database_shard_hosts: >-
  {%- set ns = namespace(default_shard=[]) -%}
  {%- for host in groups['mariadb'] -%}
    {%- if hostvars[host]['mariadb_shard_id'] is not defined or hostvars[host]['mariadb_shard_id'] == mariadb_default_database_shard_id -%}
      {%- set ns.default_shard = ns.default_shard + [host] -%}
    {%- endif -%}
  {%- endfor -%}
  {{ ns.default_shard }}
mariadb_shard_id: "{{ mariadb_default_database_shard_id }}"
mariadb_shard_name: "shard_{{ mariadb_shard_id }}"
mariadb_shard_group: "mariadb_{{ mariadb_shard_name }}"
mariadb_loadbalancer: proxysql
mariadb_backup_target: replica
mariadb_shard_root_user_prefix: "root_shard_"
mariadb_shard_backup_user_prefix: "backup_shard_"
mariadb_shards_info: "{{ groups['mariadb'] | database_shards_info() }}"

# Size in mega-bytes of each InnoDB redo log file in the log group.
# Allowed minimum is 4MB and maximum is 524288MB (512GB).
# Larger values mean less disk I/O due to less flushing checkpoint activity,
# but also slower recovery from a crash.
mariadb_innodb_log_file_size_mb: 2048
